<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Analysis System</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/strategyComparison.css">
    
    <!-- Simplified logging system -->
    <script>
        window.AppLogger = {
            LEVELS: {
                DEBUG: 0,
                INFO: 1,
                WARNING: 2,
                ERROR: 3,
                API: 4
            },
            currentLevel: 0,
            enabled: true,
            logs: [],
            maxLogs: 100,
            
            log: function(level, message, data = null) {
                if (!this.enabled || level < this.currentLevel) return;
                
                const now = new Date();
                const timestamp = now.toISOString().split('T')[1].split('.')[0];
                const prefix = ['🔍 DEBUG', 'ℹ️ INFO', '⚠️ WARNING', '❌ ERROR', '🔄 API'][level];
                const formattedMsg = `[${timestamp}] ${prefix}: ${message}`;
                
                console.log(formattedMsg, data || '');
                
                this.logs.push({
                    timestamp: now,
                    level: prefix,
                    message: message,
                    data: data
                });
                
                if (this.logs.length > this.maxLogs) {
                    this.logs.shift();
                }
            },
            
            debug: function(message, data = null) { this.log(this.LEVELS.DEBUG, message, data); },
            info: function(message, data = null) { this.log(this.LEVELS.INFO, message, data); },
            warning: function(message, data = null) { this.log(this.LEVELS.WARNING, message, data); },
            error: function(message, data = null) { this.log(this.LEVELS.ERROR, message, data); },
            api: function(method, endpoint, params = null, response = null) {
                this.log(this.LEVELS.API, `${method} ${endpoint}`, { params, response });
            },
            
            clearLogs: function() {
                this.logs = [];
                console.clear();
                this.info('Logs cleared');
            }
        };
        
        // Initialize logging and error handling
        document.addEventListener('DOMContentLoaded', function() {
            AppLogger.info('Application started', { 
                userAgent: navigator.userAgent,
                screenSize: `${window.innerWidth}x${window.innerHeight}`
            });
            
            // Error event handlers
            window.addEventListener('error', e => 
                AppLogger.error('Uncaught error', { message: e.message, source: e.filename }));
            
            window.addEventListener('unhandledrejection', e => 
                AppLogger.error('Unhandled promise rejection', { reason: e.reason }));
            
            // Simple fetch interceptor
            const originalFetch = window.fetch;
            window.fetch = async function(url, options = {}) {
                const method = (options.method || 'GET').toUpperCase();
                const endpoint = url.toString();
                
                AppLogger.api(`${method}`, endpoint, options.body ? options.body : null);
                try {
                    const response = await originalFetch(url, options);
                    return response;
                } catch (error) {
                    AppLogger.error(`Fetch ${method} failed`, { url, error: error.toString() });
                    throw error;
                }
            };
        });
    </script>
    <style>
        /* Basic styles */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <h5 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>Trading Analysis System</span>
                    </h5>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#data-section" id="data-tab">
                                <i class="bi bi-file-earmark-text"></i> Data
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#indicators-section" id="indicators-tab">
                                <i class="bi bi-graph-up"></i> Indicators
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#strategies-section" id="strategies-tab">
                                <i class="bi bi-lightbulb"></i> Strategy & Backtest
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#optimization-section" id="optimization-tab">
                                <i class="bi bi-gear"></i> Optimization
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#seasonality-section" id="seasonality-tab">
                                <i class="bi bi-calendar3"></i> Seasonality
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#results-section" id="results-tab">
                                <i class="bi bi-bar-chart"></i> Results
                            </a>
                        </li>
                    </ul>

                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>Saved Reports</span>
                    </h6>
                    <ul class="nav flex-column mb-2" id="saved-configs">
                        <!-- Saved configurations will be loaded here -->
                    </ul>
                </div>
            </div>

            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2" id="page-title">Data Upload</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="btn-group me-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary" id="save-config-btn">
                                <i class="bi bi-save"></i> Save Config
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" id="export-json-btn">
                                <i class="bi bi-file-earmark-arrow-down"></i> Export JSON
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" id="export-csv-btn">
                                <i class="bi bi-filetype-csv"></i> Export CSV
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Content sections -->
                <div id="content-area">
                    <!-- Data Section -->
                    <div id="data-section" class="content-section active">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Upload CSV Data</h5>
                                    </div>
                                    <div class="card-body">
                                        <form id="upload-form">
                                            <div class="mb-3">
                                                <label for="csv-file" class="form-label">CSV File (with Date, Open, High, Low, Close, Volume columns)</label>
                                                <input class="form-control" type="file" id="csv-file" accept=".csv,.xls,.xlsx">
                                                <div class="form-text" id="file-help-text">If no file is selected, <code>data/teste_arranged.csv</code> will be used by default.</div>
                                            </div>
                                            <button type="submit" class="btn btn-primary" id="upload-process-btn">Upload and Process</button>
                                            <button type="button" class="btn btn-info" id="arrange-btn">Arrange Data</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Data Preview</h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="data-info"></div>
                                        <div class="table-responsive">
                                            <table class="table table-striped table-sm" id="data-preview">
                                                <thead>
                                                    <tr>
                                                        <!-- Table headers will be added dynamically -->
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Table rows will be added dynamically -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Indicators Section -->
                    <div id="indicators-section" class="content-section">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Indicator Configuration</h5>
                                    </div>
                                    <div class="card-body">
                                        <form id="indicators-form">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <button type="submit" class="btn btn-primary" id="add-indicators-btn">Add Indicators</button>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="select-all-indicators">
                                                    <label class="form-check-label" for="select-all-indicators">Select All</label>
                                                </div>
                                            </div>
                                            
                                            <!-- Moving Averages Group -->
                                            <div class="card mb-3">
                                                <div class="card-header d-flex justify-content-between align-items-center">
                                                    <h6 class="mb-0">
                                                        <a href="#moving-averages-group" class="d-block text-dark text-decoration-none" data-bs-toggle="collapse" aria-expanded="true">
                                                            Moving Averages
                                                        </a>
                                                    </h6>
                                                    <div class="form-check">
                                                        <input class="form-check-input group-select" type="checkbox" id="select-moving-averages" data-group="moving-averages">
                                                        <label class="form-check-label" for="select-moving-averages">Select All</label>
                                                    </div>
                                                </div>
                                                <div id="moving-averages-group" class="collapse show">
                                                    <div class="card-body">
                                                        <div class="form-check">
                                                            <input class="form-check-input moving-averages-checkbox" type="checkbox" id="sma-checkbox" checked>
                                                            <label class="form-check-label" for="sma-checkbox">Simple Moving Averages</label>
                                                        </div>
                                                        <div class="input-group mb-3">
                                                            <span class="input-group-text">SMA Periods</span>
                                                            <input type="text" class="form-control" id="sma-periods" value="20,50,200" title="SMA Periods">
                                                        </div>
                                                        <div class="form-check">
                                                            <input class="form-check-input moving-averages-checkbox" type="checkbox" id="ema-checkbox" checked>
                                                            <label class="form-check-label" for="ema-checkbox">Exponential Moving Averages</label>
                                                        </div>
                                                        <div class="input-group mb-3">
                                                            <span class="input-group-text">EMA Periods</span>
                                                            <input type="text" class="form-control" id="ema-periods" value="12,26,50" title="EMA Periods">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Momentum Indicators Group -->
                                            <div class="card mb-3">
                                                <div class="card-header d-flex justify-content-between align-items-center">
                                                    <h6 class="mb-0">
                                                        <a href="#momentum-indicators-group" class="d-block text-dark text-decoration-none" data-bs-toggle="collapse" aria-expanded="true">
                                                            Momentum Indicators
                                                        </a>
                                                    </h6>
                                                    <div class="form-check">
                                                        <input class="form-check-input group-select" type="checkbox" id="select-momentum" data-group="momentum">
                                                        <label class="form-check-label" for="select-momentum">Select All</label>
                                                    </div>
                                                </div>
                                                <div id="momentum-indicators-group" class="collapse show">
                                                    <div class="card-body">
                                                        <div class="form-check">
                                                            <input class="form-check-input momentum-checkbox" type="checkbox" id="rsi-checkbox" checked>
                                                            <label class="form-check-label" for="rsi-checkbox">RSI</label>
                                                        </div>
                                                        <div class="input-group mb-3">
                                                            <span class="input-group-text">Period</span>
                                                            <input type="number" class="form-control" id="rsi-period" value="14" title="RSI Period">
                                                        </div>

                                                        <div class="form-check">
                                                            <input class="form-check-input momentum-checkbox" type="checkbox" id="macd-checkbox" checked>
                                                            <label class="form-check-label" for="macd-checkbox">MACD</label>
                                                        </div>
                                                        <div class="input-group mb-3">
                                                            <span class="input-group-text">Fast/Slow/Signal</span>
                                                            <input type="number" class="form-control" id="macd-fast" value="12" title="MACD Fast Period">
                                                            <input type="number" class="form-control" id="macd-slow" value="26" title="MACD Slow Period">
                                                            <input type="number" class="form-control" id="macd-signal" value="9" title="MACD Signal Period">
                                                        </div>

                                                        <div class="form-check">
                                                            <input class="form-check-input momentum-checkbox" type="checkbox" id="stoch-checkbox">
                                                            <label class="form-check-label" for="stoch-checkbox">Stochastic Oscillator</label>
                                                        </div>
                                                        <div class="input-group mb-3">
                                                            <span class="input-group-text">K/D/Slowing</span>
                                                            <input type="number" class="form-control" id="stoch-k" value="14" title="Stochastic %K">
                                                            <input type="number" class="form-control" id="stoch-d" value="3" title="Stochastic %D">
                                                            <input type="number" class="form-control" id="stoch-slowing" value="3" title="Stochastic Slowing">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Volatility Indicators Group -->
                                            <div class="card mb-3">
                                                <div class="card-header d-flex justify-content-between align-items-center">
                                                    <h6 class="mb-0">
                                                        <a href="#volatility-indicators-group" class="d-block text-dark text-decoration-none" data-bs-toggle="collapse" aria-expanded="true">
                                                            Volatility Indicators
                                                        </a>
                                                    </h6>
                                                    <div class="form-check">
                                                        <input class="form-check-input group-select" type="checkbox" id="select-volatility" data-group="volatility">
                                                        <label class="form-check-label" for="select-volatility">Select All</label>
                                                    </div>
                                                </div>
                                                <div id="volatility-indicators-group" class="collapse show">
                                                    <div class="card-body">
                                                        <div class="form-check">
                                                            <input class="form-check-input volatility-checkbox" type="checkbox" id="bbands-checkbox" checked>
                                                            <label class="form-check-label" for="bbands-checkbox">Bollinger Bands</label>
                                                        </div>
                                                        <div class="input-group mb-3">
                                                            <span class="input-group-text">Period/StdDev</span>
                                                            <input type="number" class="form-control" id="bbands-period" value="20" title="Bollinger Bands Period">
                                                            <input type="number" class="form-control" id="bbands-std" value="2" title="Bollinger Bands Standard Deviations">
                                                        </div>

                                                        <div class="form-check">
                                                            <input class="form-check-input volatility-checkbox" type="checkbox" id="atr-checkbox" checked>
                                                            <label class="form-check-label" for="atr-checkbox">ATR</label>
                                                        </div>
                                                        <div class="input-group mb-3">
                                                            <span class="input-group-text">Period</span>
                                                            <input type="number" class="form-control" id="atr-period" value="14" title="ATR Period">
                                                        </div>
                                                        
                                                        <!-- SuperTrend -->
                                                        <div class="form-check">
                                                            <input class="form-check-input volatility-checkbox" type="checkbox" id="supertrend-checkbox">
                                                            <label class="form-check-label" for="supertrend-checkbox">SuperTrend</label>
                                                        </div>
                                                        <div class="input-group mb-3">
                                                            <span class="input-group-text">ATR Period/Multiplier</span>
                                                            <input type="number" class="form-control" id="supertrend-atr-period" value="10" title="SuperTrend ATR Period">
                                                            <input type="number" class="form-control" id="supertrend-multiplier" value="3" title="SuperTrend Multiplier">
                                                        </div>
                                                        
                                                        <!-- Donchian Channels -->
                                                        <div class="form-check">
                                                            <input class="form-check-input volatility-checkbox" type="checkbox" id="donchian-checkbox">
                                                            <label class="form-check-label" for="donchian-checkbox">Donchian Channels</label>
                                                        </div>
                                                        <div class="input-group mb-3">
                                                            <span class="input-group-text">Period</span>
                                                            <input type="number" class="form-control" id="donchian-period" value="20" title="Donchian Channels Period">
                                                        </div>
                                                        
                                                        <!-- Keltner Channels -->
                                                        <div class="form-check">
                                                            <input class="form-check-input volatility-checkbox" type="checkbox" id="keltner-checkbox">
                                                            <label class="form-check-label" for="keltner-checkbox">Keltner Channels</label>
                                                        </div>
                                                        <div class="input-group mb-3">
                                                            <span class="input-group-text">EMA/ATR/Mult</span>
                                                            <input type="number" class="form-control" id="keltner-ema-period" value="20" title="Keltner EMA Period">
                                                            <input type="number" class="form-control" id="keltner-atr-period" value="10" title="Keltner ATR Period">
                                                            <input type="number" class="form-control" id="keltner-multiplier" value="1.5" title="Keltner Multiplier">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Trend Indicators Group -->
                                            <div class="card mb-3">
                                                <div class="card-header d-flex justify-content-between align-items-center">
                                                    <h6 class="mb-0">
                                                        <a href="#trend-indicators-group" class="d-block text-dark text-decoration-none" data-bs-toggle="collapse" aria-expanded="false">
                                                            Trend Indicators
                                                        </a>
                                                    </h6>
                                                    <div class="form-check">
                                                        <input class="form-check-input group-select" type="checkbox" id="select-trend" data-group="trend">
                                                        <label class="form-check-label" for="select-trend">Select All</label>
                                                    </div>
                                                </div>
                                                <div id="trend-indicators-group" class="collapse">
                                                    <div class="card-body">
                                                        <div class="form-check">
                                                            <input class="form-check-input trend-checkbox" type="checkbox" id="adx-checkbox">
                                                            <label class="form-check-label" for="adx-checkbox">ADX (+DI, -DI)</label>
                                                        </div>
                                                        <div class="input-group mb-3">
                                                            <span class="input-group-text">Period</span>
                                                            <input type="number" class="form-control" id="adx-period" value="14" title="ADX Period">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Volume Indicators Group -->
                                            <div class="card mb-3">
                                                <div class="card-header d-flex justify-content-between align-items-center">
                                                    <h6 class="mb-0">
                                                        <a href="#volume-indicators-group" class="d-block text-dark text-decoration-none" data-bs-toggle="collapse" aria-expanded="false">
                                                            Volume Indicators
                                                        </a>
                                                    </h6>
                                                    <div class="form-check">
                                                        <input class="form-check-input group-select" type="checkbox" id="select-volume" data-group="volume">
                                                        <label class="form-check-label" for="select-volume">Select All</label>
                                                    </div>
                                                </div>
                                                <div id="volume-indicators-group" class="collapse">
                                                    <div class="card-body">
                                                        <div class="form-check">
                                                            <input class="form-check-input volume-checkbox" type="checkbox" id="volume-checkbox" checked>
                                                            <label class="form-check-label" for="volume-checkbox">Volume Analysis (OBV, VPT)</label>
                                                        </div>
                                                        
                                                        <!-- Accumulation Distribution Line -->
                                                        <div class="form-check">
                                                            <input class="form-check-input volume-checkbox" type="checkbox" id="ad-line-checkbox">
                                                            <label class="form-check-label" for="ad-line-checkbox">Accumulation/Distribution Line</label>
                                                        </div>
                                                        
                                                        <!-- Chaikin Money Flow -->
                                                        <div class="form-check">
                                                            <input class="form-check-input volume-checkbox" type="checkbox" id="cmf-checkbox">
                                                            <label class="form-check-label" for="cmf-checkbox">Chaikin Money Flow</label>
                                                        </div>
                                                        <div class="input-group mb-3">
                                                            <span class="input-group-text">Period</span>
                                                            <input type="number" class="form-control" id="cmf-period" value="20" title="CMF Period">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Oscillator Indicators Group -->
                                            <div class="card mb-3">
                                                <div class="card-header d-flex justify-content-between align-items-center">
                                                    <h6 class="mb-0">
                                                        <a href="#oscillator-indicators-group" class="d-block text-dark text-decoration-none" data-bs-toggle="collapse" aria-expanded="false">
                                                            Oscillator Indicators
                                                        </a>
                                                    </h6>
                                                    <div class="form-check">
                                                        <input class="form-check-input group-select" type="checkbox" id="select-oscillator" data-group="oscillator">
                                                        <label class="form-check-label" for="select-oscillator">Select All</label>
                                                    </div>
                                                </div>
                                                <div id="oscillator-indicators-group" class="collapse">
                                                    <div class="card-body">
                                                        <!-- CCI -->
                                                        <div class="form-check">
                                                            <input class="form-check-input oscillator-checkbox" type="checkbox" id="cci-checkbox">
                                                            <label class="form-check-label" for="cci-checkbox">Commodity Channel Index (CCI)</label>
                                                        </div>
                                                        <div class="input-group mb-3">
                                                            <span class="input-group-text">Period</span>
                                                            <input type="number" class="form-control" id="cci-period" value="20" title="CCI Period">
                                                        </div>
                                                        
                                                        <!-- Williams %R -->
                                                        <div class="form-check">
                                                            <input class="form-check-input oscillator-checkbox" type="checkbox" id="williams-r-checkbox">
                                                            <label class="form-check-label" for="williams-r-checkbox">Williams %R</label>
                                                        </div>
                                                        <div class="input-group mb-3">
                                                            <span class="input-group-text">Period</span>
                                                            <input type="number" class="form-control" id="williams-r-period" value="14" title="Williams %R Period">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Candlestick Patterns Group -->
                                            <div class="card mb-3">
                                                <div class="card-header d-flex justify-content-between align-items-center">
                                                    <h6 class="mb-0">
                                                        <a href="#candlestick-patterns-group" class="d-block text-dark text-decoration-none" data-bs-toggle="collapse" aria-expanded="false">
                                                            Candlestick Patterns
                                                        </a>
                                                    </h6>
                                                    <div class="form-check">
                                                        <input class="form-check-input group-select" type="checkbox" id="select-patterns" data-group="patterns">
                                                        <label class="form-check-label" for="select-patterns">Select All</label>
                                                    </div>
                                                </div>
                                                <div id="candlestick-patterns-group" class="collapse">
                                                    <div class="card-body">
                                                        <div class="form-check">
                                                            <input class="form-check-input patterns-checkbox" type="checkbox" id="candlestick-patterns-checkbox">
                                                            <label class="form-check-label" for="candlestick-patterns-checkbox">Enable All Patterns</label>
                                                        </div>
                                                        <div class="patterns-container ps-4">
                                                            <div class="form-check">
                                                                <input class="form-check-input pattern-checkbox patterns-checkbox" type="checkbox" id="doji-checkbox">
                                                                <label class="form-check-label" for="doji-checkbox">Doji</label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input pattern-checkbox patterns-checkbox" type="checkbox" id="engulfing-checkbox">
                                                                <label class="form-check-label" for="engulfing-checkbox">Engulfing (Bullish/Bearish)</label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input pattern-checkbox patterns-checkbox" type="checkbox" id="hammer-checkbox">
                                                                <label class="form-check-label" for="hammer-checkbox">Hammer/Inverted Hammer</label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input pattern-checkbox patterns-checkbox" type="checkbox" id="morning-star-checkbox">
                                                                <label class="form-check-label" for="morning-star-checkbox">Morning/Evening Star</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Chart</h5>
                                    </div>
                                    <div class="card-body">
                                        <form id="chart-form" class="mb-3">
                                            <div class="row">
                                                <div class="col-md-5">
                                                    <div class="mb-3">
                                                        <label for="main-indicators" class="form-label">Main Indicators</label>
                                                        <select multiple class="form-select" id="main-indicators" size="5">
                                                            <!-- Options will be added dynamically -->
                                                        </select>
                                                        <button type="button" class="btn btn-sm btn-danger mt-1" id="remove-main"><i class="bi bi-trash"></i> Remove Selected</button>
                                                    </div>
                                                </div>
                                                <div class="col-md-2 d-flex align-items-center justify-content-center">
                                                    <div class="btn-group-vertical">
                                                        <button type="button" class="btn btn-primary mb-2" id="move-to-main">
                                                            <i class="bi bi-arrow-left"></i> To Main
                                                        </button>
                                                        <button type="button" class="btn btn-primary" id="move-to-subplot">
                                                            To Subplot <i class="bi bi-arrow-right"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="col-md-5">
                                                    <div class="mb-3">
                                                        <label for="subplot-indicators" class="form-label">Subplot Indicators</label>
                                                        <select multiple class="form-select" id="subplot-indicators" size="5">
                                                            <!-- Options will be added dynamically -->
                                                        </select>
                                                        <button type="button" class="btn btn-sm btn-danger mt-1" id="remove-subplot"><i class="bi bi-trash"></i> Remove Selected</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label for="chart-start-date" class="form-label">Start Date</label>
                                                        <input type="date" class="form-control" id="chart-start-date">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label for="chart-end-date" class="form-label">End Date</label>
                                                        <input type="date" class="form-control" id="chart-end-date">
                                                    </div>
                                                </div>
                                            </div>
                                            <button type="submit" class="btn btn-primary" id="plot-chart-btn">Plot Chart</button>
                                        </form>
                                        <div id="chart-container">
                                            <img id="chart-image" class="img-fluid" style="display: none;">
                                        </div>
                                        <div id="indicator-summary" class="mt-3">
                                            <!-- Indicator summary will be displayed here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Strategy Section -->
                    <div id="strategies-section" class="content-section">
                        <h4>Select and Configure Strategy</h4>
                        <div class="row">
                            <div class="col-lg-5 col-md-6"> <!-- Column for Strategy Selection & Params -->
                                <div class="row mb-3">
                                    <div class="col-md-12"> <!-- Full width within its column -->
                                        <label for="strategy-select" class="form-label">Strategy</label>
                                        <select id="strategy-select" class="form-select"></select>
                                    </div>
                                </div>
                                <div id="strategy-description" class="mb-3">
                                    <p><em>Select a strategy to see its description and configure parameters.</em></p>
                                </div>
                                <div id="strategy-parameters-form" class="mb-3">
                                    <!-- Strategy parameters will be loaded here, now in a narrower column -->
                                </div>
                            </div>
                            <div class="col-lg-7 col-md-6"> <!-- Column for Strategy Comparison -->
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Compare Strategies</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label>Select strategies to compare:</label>
                                            <div id="strategy-comparison-checkboxes" class="mt-2 mb-3 strategy-checkboxes">
                                                <!-- Checkboxes will be populated here by JS -->
                                            </div>
                                            <button type="button" class="btn btn-info" id="compare-strategies-btn">Compare Selected Strategies</button>
                                        </div>
                                        
                                        <div id="strategy-comparison-results" class="mt-3">
                                            <!-- Strategy parameters will be displayed here after selection -->
                                        </div>
                                        
                                        <div id="comparison-options" class="mt-3 mb-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="optimize-comparison-checkbox">
                                                <label class="form-check-label" for="optimize-comparison-checkbox">
                                                    Optimize Parameters (Grid Search)
                                                </label>
                                            </div>
                                            <div class="mt-3">
                                                <button type="button" class="btn btn-primary" id="run-full-comparison-btn">Run Full Comparison</button>
                                            </div>
                                        </div>
                                        
                                        <div id="comparison-results-display" class="mt-4 pt-3 border-top d-none">
                                            <h5>Comparison Results</h5>
                                            <p><em>This is a placeholder for actual comparison results. In a full implementation, this would show performance metrics side by side.</em></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <hr class="my-4">

                        <h4>Backtest Configuration & Execution</h4>
                        <div class="row">
                            <div class="col-md-4">
                                <label for="initial-capital" class="form-label">Initial Capital</label>
                                <input type="number" class="form-control" id="initial-capital" value="100">
                            </div>
                            <div class="col-md-4">
                                <label for="commission" class="form-label">Commission Rate (e.g., 0.001 for 0.1%)</label>
                                <input type="number" step="0.0001" class="form-control" id="commission" value="0.001">
                            </div>
                        </div>
                        <div class="row mt-3">
                             <div class="col-md-4">
                                <label for="backtest-start-date" class="form-label">Backtest Start Date</label>
                                <input type="date" class="form-control" id="backtest-start-date">
                            </div>
                            <div class="col-md-4">
                                <label for="backtest-end-date" class="form-label">Backtest End Date</label>
                                <input type="date" class="form-control" id="backtest-end-date">
                            </div>
                        </div>
                        <button type="button" class="btn btn-success mt-3" id="run-backtest-btn">Run Backtest</button>

                        <div id="backtest-results" class="mt-4">
                            <h5>Backtest Results</h5>
                            <div id="backtest-summary" class="mb-3"></div>
                            <div class="row">
                                <div class="col-md-12" id="backtest-charts">
                                     <!-- Chart.js expects a canvas; backtestView.js creates it or I can pre-define it -->
                                     <!-- Content of backtest-charts (like equity curve canvas) will be populated by backtestView.js --> 
                                </div>
                            </div>
                            <div id="trade-history" class="mt-3">
                                <h6>Trade History</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm table-striped" id="trade-history-table">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Type</th>
                                                <th>Price</th>
                                                <th>Amount</th>
                                                <th>Value</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Trade history rows will be inserted here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Optimization Section -->
                    <div id="optimization-section" class="content-section">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Optimization Configuration</h5>
                                    </div>
                                    <div class="card-body">
                                        <form id="optimization-form">
                                            <div class="mb-3">
                                                <label for="optimization-strategy" class="form-label">Strategy</label>
                                                <select class="form-select" id="optimization-strategy">
                                                    <option value="trend_following">Trend Following (Moving Average Crossover)</option>
                                                    <option value="mean_reversion">Mean Reversion (RSI)</option>
                                                    <option value="breakout">Breakout (Price & Volume)</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label for="optimization-metric" class="form-label">Optimization Metric</label>
                                                <select class="form-select" id="optimization-metric">
                                                    <option value="sharpe_ratio">Sharpe Ratio</option>
                                                    <option value="total_return">Total Return</option>
                                                    <option value="annual_return">Annual Return</option>
                                                    <option value="max_drawdown">Max Drawdown</option>
                                                    <option value="win_rate">Win Rate</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label for="optimization-start-date" class="form-label">Start Date</label>
                                                <input type="date" class="form-control" id="optimization-start-date">
                                            </div>
                                            <div class="mb-3">
                                                <label for="optimization-end-date" class="form-label">End Date</label>
                                                <input type="date" class="form-control" id="optimization-end-date">
                                            </div>
                                            <div id="optimization-parameters">
                                                <!-- Strategy-specific parameter ranges will be added dynamically -->
                                            </div>
                                            <button type="submit" class="btn btn-primary" id="run-optimization-btn">Run Optimization</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Optimization Results</h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="optimization-results">
                                            <div class="alert alert-info">
                                                <i class="bi bi-info-circle"></i> Select a strategy and run optimization to see results here.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Seasonality Section -->
                    <div id="seasonality-section" class="content-section">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Seasonality Configuration</h5>
                                    </div>
                                    <div class="card-body">
                                        <form id="seasonality-form">
                                            <div class="mb-3">
                                                <label for="seasonality-type" class="form-label">Seasonality Type</label>
                                                <select class="form-select" id="seasonality-type" name="pattern_type" title="Select Seasonality Type">
                                                    <option value="day_of_week">Day of Week</option>
                                                    <option value="monthly">Monthly</option>
                                                    <option value="volatility">Volatility</option>
                                                    <option value="heatmap">Heatmap</option>
                                                </select>
                                            </div>
                                            <div id="seasonality-parameters">
                                                <!-- Seasonality-specific parameters will be added dynamically -->
                                            </div>
                                            <button type="submit" class="btn btn-primary" id="run-seasonality-btn">Run Seasonality Analysis</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Seasonality Results</h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="seasonality-results">
                                            <!-- Seasonality results will be displayed here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Results Section -->
                    <div id="results-section" class="content-section">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Performance Metrics</h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="performance-metrics">
                                            <!-- Performance metrics will be displayed here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Trade Analysis</h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="trade-analysis">
                                            <!-- Trade analysis will be displayed here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Trade History</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-sm" id="trade-history">
                                                <thead>
                                                    <tr>
                                                        <th>Entry Date</th>
                                                        <th>Exit Date</th>
                                                        <th>Entry Price</th>
                                                        <th>Exit Price</th>
                                                        <th>Return</th>
                                                        <th>Duration</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Trade history will be displayed here -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Error modal -->
    <div class="modal fade" id="error-modal" tabindex="-1" aria-labelledby="error-modal-label" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="error-modal-label">Error</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="error-message">
                    <!-- Error message will be displayed here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Save config modal -->
    <div class="modal fade" id="save-config-modal" tabindex="-1" aria-labelledby="save-config-modal-label" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="save-config-modal-label">Save Configuration</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="save-config-form">
                        <div class="mb-3">
                            <label for="config-name" class="form-label">Configuration Name</label>
                            <input type="text" class="form-control" id="config-name" placeholder="My Strategy Config" title="Configuration Name">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-config-confirm">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Chart.js library and date adapter -->
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
    
    <!-- Application Scripts -->
    <script type="module" src="/static/js/main.js"></script>
</body>
</html> 